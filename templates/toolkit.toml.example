# Claude Toolkit Configuration
# Copy this file to .claude/toolkit.toml in your project and customize.
# Run: python3 generate-config-cache.py --toml .claude/toolkit.toml --output .claude/toolkit-cache.env

# ---------------------------------------------------------------------------
# [toolkit] — Toolkit-level metadata
# ---------------------------------------------------------------------------
[toolkit]
# Git remote for the toolkit repo (used for updates)
remote_url = "git@github.com:user/claude-toolkit.git"

# ---------------------------------------------------------------------------
# [project] — Project identification
# ---------------------------------------------------------------------------
[project]
# Display name used in session banners and notifications
name = "my-project"

# File containing the current version (read by session-start, subagent-context)
version_file = "VERSION"

# Technology stacks present in the project
# Options: "python", "ios", "typescript"
stacks = ["python"]

# ---------------------------------------------------------------------------
# [hooks.setup] — Environment validation (runs once per session)
# ---------------------------------------------------------------------------
[hooks.setup]
# Minimum Python version required (major.minor)
python_min_version = "3.11"

# Tools that MUST be installed (setup fails with warning if missing)
required_tools = ["ruff", "jq"]

# Tools that are nice to have (setup emits info if missing, does not warn)
optional_tools = []

# Security scanning tools (checked separately, optional)
security_tools = ["gitleaks", "semgrep"]

# ---------------------------------------------------------------------------
# [hooks.post-edit-lint.linters] — Per-extension lint/format commands
# Keys are file extensions (without dot). Each entry has:
#   cmd      — lint check command (receives file path as argument)
#   fmt      — format command (receives file path as argument)
#   fallback — fallback command name if cmd is not found at the given path
# ---------------------------------------------------------------------------
[hooks.post-edit-lint.linters]
[hooks.post-edit-lint.linters.py]
cmd = ".venv/bin/ruff check"
fmt = ".venv/bin/ruff format"
fallback = "ruff"

[hooks.post-edit-lint.linters.md]
cmd = "npx markdownlint-cli2"
fmt = "npx markdownlint-cli2 --fix"

# Example for TypeScript:
# [hooks.post-edit-lint.linters.ts]
# cmd = "npx eslint"
# fmt = "npx prettier --write"
# fallback = "eslint"

# ---------------------------------------------------------------------------
# [hooks.task-completed.gates] — Quality gates checked before task completion
# Keys are gate names. Each entry has:
#   glob      — file glob pattern that triggers this gate
#   cmd       — command to run (exit 0 = pass, non-zero = fail)
#   timeout   — max seconds before the gate is killed (default: 90)
# ---------------------------------------------------------------------------
[hooks.task-completed.gates]
[hooks.task-completed.gates.lint]
glob = "*.py"
cmd = ".venv/bin/ruff check --quiet"

[hooks.task-completed.gates.tests]
glob = "*.py"
cmd = "make test-changed"
timeout = 90

# ---------------------------------------------------------------------------
# [hooks.auto-approve] — Paths and commands auto-approved without prompting
# ---------------------------------------------------------------------------
[hooks.auto-approve]
# Glob patterns for Write/Edit paths that are auto-approved (one-time, not persisted)
write_paths = [
    "*/app/*",
    "*/src/*",
    "*/lib/*",
    "*/tests/*",
    "*/test/*",
    "*/docs/*",
    "*/artifacts/*",
    "*/scripts/*",
    "*/.claude/*",
    "*/CLAUDE.md",
    "*/PROJECT_CONTEXT.md",
    "*/Makefile",
    "*/VERSION",
    "*/requirements*.txt",
    "*/package*.json",
    "*/pyproject.toml",
    "*/docker-compose*.yml",
    "*/README.md",
    "*/pytest.ini",
    "*/Dockerfile",
    "*/setup.sh",
    "*/tsconfig*.json",
]

# Additional Bash commands to auto-approve (one-time)
# These are matched as prefixes against the first word of the command
bash_commands = []

# MCP tool prefixes to auto-approve (persist for session)
# Each entry is matched as a prefix against the tool name
# Default: ["mcp__codex__", "mcp__plugin_playwright_playwright__", "mcp__plugin_context7_context7__"]
mcp_tool_prefixes = [
    "mcp__codex__",
    "mcp__plugin_playwright_playwright__",
    "mcp__plugin_context7_context7__",
]

# ---------------------------------------------------------------------------
# [hooks.subagent-context] — Context injected into subagents
# ---------------------------------------------------------------------------
[hooks.subagent-context]
# Critical rules injected into every subagent's context
critical_rules = []

# Tools/capabilities available in this project (informational for subagents)
available_tools = []

# Short description of the tech stack (injected into subagent context)
stack_info = ""

# ---------------------------------------------------------------------------
# [hooks.compact] — Pre-compact state preservation
# ---------------------------------------------------------------------------
[hooks.compact]
# Directories scanned for recently modified source files
source_dirs = ["app", "src"]

# File extensions to include when scanning for recent changes
source_extensions = ["*.py"]

# Directories checked for active orchestration state (implement/solve/refine)
state_dirs = ["artifacts"]

# ---------------------------------------------------------------------------
# [hooks.session-end] — Session cleanup thresholds
# ---------------------------------------------------------------------------
[hooks.session-end]
# Max lines in agent memory files before auto-truncation
agent_memory_max_lines = 250

# Max lines in hook log before pruning
hook_log_max_lines = 500

# ---------------------------------------------------------------------------
# [notifications] — macOS / Linux notification settings
# ---------------------------------------------------------------------------
[notifications]
# Application name shown in notifications
app_name = "Claude Code"

# macOS sound name for permission prompts (use "none" for silent)
# Common sounds: Blow, Ping, Pop, Glass, Submarine, Tink
permission_sound = "Blow"

# ---------------------------------------------------------------------------
# Skill Defaults
# ---------------------------------------------------------------------------
# Uncomment and modify to override skill defaults.
# Run `bash toolkit.sh customize skills/<skill>/SKILL.md` to take ownership.

# [skills.brainstorm]
# depth = "normal"                # Default depth: "shallow", "normal", or "deep"
# output_dir = "docs/ideas"       # Directory for idea documents
# codex_iterations = 5            # Max codex review iterations
# personas = 4                    # Max personas in normal mode (6 in deep)
# gemini_enabled = false          # Include Gemini second-opinion persona
# auto_plan = false               # Auto-spawn /plan after brainstorm completes

# [skills.implement]
# codex_iterations = 3            # Max codex review iterations per milestone
# qa_mode = "smoke"               # QA mode after each milestone: "smoke" or "deep"

# [skills.refine]
# max_iterations = 8              # Max evaluate-fix-validate iterations
# convergence_threshold = 2       # Max new findings per iteration before plateau
# deferred_drop_after = 2         # Drop findings deferred N consecutive times

# [skills.plan]
# output_dir = "docs/plans"       # Directory for plan documents
# feedback_iterations = 10        # Max codex feedback iterations
# auto_implement = false          # Auto-spawn /implement after plan finalization

# [skills.fix]
# scan_cap = 20                   # Max similar-pattern matches to collect
# max_fix_attempts = 3            # Fix attempts before escalating to user

# [skills.solve]
# skip_review = false             # Skip QA review at end
# plan_only = false               # Create plan without implementing
# max_fix_attempts = 3            # Fix attempts before escalating to user

# [skills.review-suite]
# agents = "reviewer"             # Default agent(s): "reviewer", "all", or comma-separated
# scope = "uncommitted"           # Default scope: "uncommitted", "diff:HEAD~1", etc.
# max_parallel_agents = 3         # Max agents running in parallel
# smoke_timeout = 600             # Smoke mode timeout in seconds (10 min)
# deep_timeout = 3600             # Deep mode timeout in seconds (60 min)
